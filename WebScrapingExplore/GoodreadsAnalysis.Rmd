---
title: "Goodreads Reviews Analysis"
author: "David Nicolay, Kellen Mossner, Matthew Holm"
date: "2024-10-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries}
library(tidyverse)
library(tidytext)
library(stringr)
library(textdata)
```

Import the data
```{r}
reviews <- read.csv("data/goodreads_reviews_all.csv", header = TRUE)
```

```{r lexicons}
get_sentiments("afinn") %>% head(10)
get_sentiments("bing") %>% head(10)
get_sentiments("nrc") %>% head(10)
```


```{r}
reviews_sentiment <- reviews %>%
  unnest_tokens(word, Review.Text) %>%
  inner_join(get_sentiments("afinn")) %>%
  group_by(Book.Title) %>%
  summarize(sentiment = sum(value)) %>%
  arrange(desc(sentiment))

# View the top 10 books by sentiment score
head(reviews_sentiment, 10)
```


```{r nrc emotions}
bing_word_counts <- reviews %>%
  unnest_tokens(word, Review.Text) %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  ungroup()

bing_word_counts %>%
  group_by(sentiment) %>%
  slice_max(n, n = 10) %>%
  ungroup() %>%
  ggplot(aes(n, reorder(word, n), fill = sentiment)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~sentiment, scales = "free_y") +
  labs(x = "Contribution to sentiment", y = NULL)
```

## [NLP] Question: Which review words resulted in highest rating?
First let's clean the dataset for our specific purpose. The words should also be tokenized and stopwords removed.

```{r tokenize}
# Select the relevant columns
words_rating_reviews <- reviews %>% 
  select(Review.Text, Review.Stars)
  
# Tokenize the review text
words_ratings <- words_rating_reviews %>%
  unnest_tokens(word, Review.Text) %>%
  anti_join(stop_words) # Remove stop words
```

```{r calc_avg_rating}
# Calculate average ratings for each word
word_avg_ratings <- words_ratings %>%
  group_by(word) %>%
  summarise(
    avg_rating = mean(Review.Stars),
    count = n()
  ) %>%
  filter(count >= 10)  # Filter words that appear at least 10 times
```


Now let's find the top words by average rating.
```{r}
# Find the words with the highest ratings
top_words <- word_avg_ratings %>%
  arrange(desc(avg_rating)) %>%
  head(20)

# Display the results
print(top_words)
```

As somewhat is to be expected, the common words that result in high reviews don't generlize well acrross books. No trend can easily be indentified from this top average rating list.






## [Sentiment Analysis] Question: How does the sentiment of reviews correlate with the star rating given?

## [Topic Analysis] Question: What are the most common topics or themes discussed in positive vs. negative reviews?

## Question: Can we detect sarcasm or irony in reviews, and how does it relate to the overall rating?